<!DOCTYPE html>
<html>
<head>
    <title>{{ patient.name }} - CKD Risk</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script defer src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body data-patient-id="{{ patient.id }}">

    <div class="navbar">
        <a href="/">Back to Patients</a>
    </div>

    <div class="container fade-in">
        <h1>{{ patient.name }}</h1>
        <p><strong>Age:</strong> {{ patient.age }}</p>

        <!-- Kidney Function Graph -->
        <h2>Kidney Function Over Time (eGFR)</h2>
        <canvas id="eGFRChart"></canvas>

        <!-- UACR Trend -->
        <h2>Proteinuria (UACR) Levels</h2>
        <canvas id="UACRChart"></canvas>

        <!-- Medications -->
        <h2>Medications</h2>
        <ul>
            {% for med in patient.medications %}
                <li class="alert-box">ðŸ’Š {{ med }}</li>
            {% endfor %}
        </ul>

        <!-- Medical Visits -->
        <h2>Medical Visits</h2>
        <canvas id="visitTimeline"></canvas>

        <!-- Transplant Status -->
        <h2>Transplant Status</h2>
        {% if patient.transplant %}
            <p class="alert-box">âœ… Kidney Transplant Completed</p>
        {% else %}
            <p class="alert-box">ðŸš¨ No Kidney Transplant Recorded</p>
        {% endif %}
    </div>

    <!-- Chatbot Toggle Button -->
    <button id="chatbot-toggle" onclick="toggleChatbot()">ðŸ’¬ Chat</button>

    <!-- Chatbot Container -->
    <div id="chatbot-container" style="display: none;">
        <div id="chatbot-header">
            <span>ðŸ’¬ Ask AI</span>
            <button id="close-chatbot" onclick="toggleChatbot()">âœ–</button>
        </div>
        <div id="chatbot-body">
            <div id="chat-messages"></div>
        </div>
        <div id="chat-input-container">
            <input type="text" id="chat-input" placeholder="Ask about reports, labs...">
            <button id="send-btn" onclick="sendMessage()">Send</button>
        </div>
    </div>



    <script>
        const eGFRData = {{ patient.eGFR_trend | tojson }};
        const UACRData = {{ patient.UACR_trend | tojson }};
        const visitDates = {{ patient.visit_dates | tojson }};
    </script>

</body>
</html>
